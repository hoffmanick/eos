---
title: "xdd"
author: "Nick Hoffman"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}


pubs = content(GET(paste0('https://api.neotomadb.org/v2.0/data/dbtables/publications?count=false&limit=99999&offset=0')))$data



pub_mat = matrix(nrow=length(pubs),ncol=28)

for (i in seq(length(pubs))) {
  for (j in seq(26)) {
    if (!is.null(pubs[[i]][[j]])) {
      pub_mat[[i,j]] = pubs[[i]][[j]]
    }
  }
   if (!is.null(pubs[[i]][[28]])) {
      pub_mat[[i,27]] = pubs[[i]][[28]]
   }
  if (!is.null(pubs[[i]][[27]]$DOI)) {
     pub_mat[[i,28]] = pubs[[i]][[27]]$DOI
  }
}

pub_df = pub_mat %>% as.data.frame()

names(pub_df) =c("publicationid","pubtypeid","year","citation","articletitle","journal","volume","issue","pages","citationnumber","doi","booktitle","numvolumes","edition","volumetitle","seriestitle","seriesvolume","publisher","url","city","state","country","originallanguage","notes","datecreated","datemodified","bibtex","crossrefDOI")


pub_with_doi = pub_df %>% dplyr::filter(!is.na(doi))

pub_with_crossrefdoi = pub_df %>% dplyr::filter(!is.na(crossrefDOI))

dois = pub_with_doi %>% rbind(pub_with_crossrefdoi) %>% distinct()
dois = dois %>% dplyr::filter(!doi  %in% c("10.1073\002pnas.0530193100","10.1073\002pnas.0408315102"))
articles=list()
for (i in seq(length(dois[[1]]))) {
print(i)
if (!grepl(" ",dois$doi[[i]])) {
  val = dois$doi[[i]]
} else {
  val <- sub(" .*", "", dois$doi[[i]])
}
    
  article= content(GET(paste0("https://xdd.wisc.edu/api/articles?doi=",val)))$success$data

  if (length(article) != 0) {
    articles = append(articles,article)
  }
  
}

#article= content(GET(paste0("https://xdd.wisc.edu/api/articles?doi=10.15468/39omei")))$success$data


nodoi = pub_df %>% dplyr::filter(is.na(doi)) %>% dplyr::filter(!grepl("https:",articletitle))

articles2=list()
for (i in seq(length(nodoi[[1]]))) {
print(i)
title = nodoi$articletitle[[i]]
article= content(GET(paste0("https://xdd.wisc.edu/api/articles?pubname_like=",URLencode(title))))$success$data

  if (length(article) != 0) {
    articles2 = append(articles2,article)
  }
  
}

articles_all = append(articles,articles2)
article_mat = matrix(nrow=length(articles_all),ncol=5)
for ( i in seq(length(articles_all))) {
  article_mat[[i,1]] = articles_all[[i]][['_gddid']]
  article_mat[[i,2]] = articles_all[[i]]$title
  article_mat[[i,3]] = articles_all[[i]]$volume
  article_mat[[i,4]] = articles_all[[i]]$journal
  if(!is.null(articles_all[[i]]$year)) {
  article_mat[[i,5]] = articles_all[[i]]$year}
}

article_df = as.data.frame(article_mat)
names(article_df) = c("id","title","volume","journal","year")
```



```{r snip}

ids = paste0(article_df$id[1],collapse=",")

content(GET(paste0('https://xdd.wisc.edu/api/snippets?term=temporal&docid=',ids)))$success$data
```
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
